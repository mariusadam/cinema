{% extends 'layout.html' %}
{% block title %}
    Income calculator
{% endblock %}

{% block pageIncludes %}
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script> 
    <script src="//cdn.jsdelivr.net/webshim/1.14.5/polyfiller.js"></script>
    <script>
    webshims.setOptions('forms-ext', {types: 'date'});
    webshims.polyfill('forms forms-ext');
    $.webshims.formcfg = {
    en: {
        dFormat: '/',
        dateSigns: '/',
        patterns: {
            d: "mm/dd/yy"
        }
    }
    };
    </script>
{% endblock %}

{% block pageScripts %}
<script>
    function getDefaultDate(){

        var now = new Date();
        var day = ("0" + now.getDate()).slice(-2);
        var month = ("0" + (now.getMonth() + 1)).slice(-2);
        var today = now.getFullYear()+"-"+(month)+"-"+(day) ;

        return today;
    }
    debugger;
    $("#end_date").attr('max', getDefaultDate());
    
    $("#form-income").submit(function(event) {

                /* stop form from submitting normally */
                event.preventDefault();

                /* get some values from elements on the page: */
                var $form = $(this);
                var url = $form.attr('action');
                debugger;
                /* Send the data using post */
                $.ajax({
                    method: 'POST',
                    url: url,
                    dataType: "json",
                    data: {
                        value: "$(this).text()"
                    },
                    success: function (data) {
                        alert("succes");
                    }
                });
            });
            </script>
{% endblock %}


{% block content %}

    <div class="authArea">
        <div class="container">
            
          <div class="col-lg-6 col-centered">
            {% for message in flashBag.get('error') %}
                    {{ message }}
                {% endfor %}
            {% for message in flashBag.get('success') %}
                    {{ message }}
                {% endfor %}
                
            <h1 class="text-center"><i class="fa fa-video-camera" aria-hidden="true"></i> CinemaVillage</h1>
            
            <form id="form-income" class="form-income" method="POST" action="{{ url('admin_movie_income', {'id': movie.getId}) }}">
                
                <span class="title text-center">Compute income for movie "{{movie.getTitle|default("")}}"</span><hr/>
                
                <label for="email"><i class="fa fa-envelope" aria-hidden="true"></i> Start date</label>
                <input class="form-control" type="date" name="start_date" min="1950-01-01"><br>
                
                <label for="password"><i class="fa fa-key" aria-hidden="true"></i> End date</label>
                <input class="form-control" id="end_date" type="date" name="end_date" max=""><br>
                
                <button id="btn-submit" class="btn btn-lg btn-primary btn-block" type="submit">Get income <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
            </form>
            <div id="result"></div>
        </div>
    </div>
{% endblock %}
