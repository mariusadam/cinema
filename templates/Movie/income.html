{% extends 'layout.html' %}
{% block title %}
Income calculator
{% endblock %}

{% block pageIncludes %}
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script> 
    <script src="//cdn.jsdelivr.net/webshim/1.14.5/polyfiller.js"></script>
{% endblock %}


{% block pageScripts %}
<script>
    webshims.setOptions('forms-ext', {types: 'date'});
    webshims.polyfill('forms forms-ext');
    $.webshims.formcfg = {
        en: {
            dFormat: '/',
            dateSigns: '/',
            patterns: {
                d: "mm/dd/yy"
            }
        }
    };
    function getDefaultDate() {

        var now = new Date();
        var day = ("0" + now.getDate()).slice(-2);
        var month = ("0" + (now.getMonth() + 1)).slice(-2);
        var today = now.getFullYear() + "-" + (month) + "-" + (day);

        return today;
    }
    $("#form-income").submit(function (e) {

        var url = $("#form-income").attr('action'); // the script where you handle the form input.

        $.ajax({
            type: "POST",
            url: url,
            data: $("#form-income").serialize(), // serializes the form's elements.
            success: function (data)
            {
                var income = data.income; // response from the php script.
                $('#result').text("The income for this movie is" + income);
            }
        });

        e.preventDefault(); // avoid to execute the actual submit of the form.
    });
    $("#form-income").submit(function (event) {

        /* stop form from submitting normally */
        event.preventDefault();

        /* get some values from elements on the page: */
        var $form = $(this);
        var url = $form.attr('action');
        debugger;
        /* Send the data using post */
        $.ajax({
            method: 'POST',
            url: url,
            dataType: "json",
            data: {
                value: "$(this).text()"
            },
            success: function (data) {
                alert("succes");
            }
        });
    });
</script>

{% endblock %}

{% block content %}

<div class="authArea">
    <div class="container">

        <div class="col-lg-6 col-centered">
            {% for message in flashBag.get('error') %}
            {{ message }}
            {% endfor %}
            {% for message in flashBag.get('success') %}
            {{ message }}
            {% endfor %}

            <h1 class="text-center"><i class="fa fa-video-camera" aria-hidden="true"></i> CinemaVillage</h1>

            <form id="form-income" class="form-income" method="POST" action="{{ url('admin_movie_income', {'id': movie.getId}) }}">

                <span class="title text-center">Compute income for movie "{{movie.getTitle|default("")}}"</span><hr/>

                <label for="start_date"><i class="fa fa-envelope" aria-hidden="true"></i> Start date</label>
                <input required placeholder="mm/dd/yyyy" class="form-control" type="date" name="start_date" min="{{min_date}}"><br>

                <label for="end_date"><i class="fa fa-key" aria-hidden="true"></i> End date</label>
                <input required placeholder="mm/dd/yyyy" class="form-control" type="date" id="end_date" name="end_date" max="{{ max_date }}"><br>
                <button class="btn btn-lg btn-primary btn-block" type="submit">Get income <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
            </form>
            <div id='result' class='showList'>

            </div>
        </div>
    </div>
    {% endblock %}
